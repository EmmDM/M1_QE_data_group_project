---
title: "Data Group Project"
author: "Victoire Truchon Bartes & Emmanuel de MOREL"
format: html
---

Here the link to the github project : https://github.com/EmmDM/M1_QE_data_group_project

Here the links to the original sources : 
For the OECD : 
https://data-explorer.oecd.org/vis?lc=fr&pg=0&fs[0]=Th%C3%A8me%2C1%7CEnvironnement%23ENV%23%7CPolitiques%20de%27l%20environnementale%23ENV_POL%23&bp=true&snb=8&df[ds]=dsDisseminateFinalDMZ&df[id]=DSD_GG%40DF_GREEN_GROWTH&df[ag]=OECD.ENV.EPI&df[vs]=1.0&pd=1990%2C2022&dq=FRA.A.CO2_PBPROD%2BCO2_PBEMCAP%2BCO2_PBEM%2BCO2_DBPROD%2BCO2_DBPROD_NNDI%2BCO2_DBEMCAP%2BCO2_DBEM%2BNRG_PROD%2BNRG_INT%2BNRGS%2BRE_TPES%2BRE_NRG%2BNRGC%2BRE_TPES_EBIOM%2BMWAS_INT%2BMWAS_INC%2BMWAS_RECO%2BMWAS_LANDF%2BEAMFP_EAMFPG%2BEAMFP_NKG%2BWATER_STPC%2BWATER_FWCAP%2BWATER_FW%2BPM_PWM%2BPM_SPEX10%2BPM_SPEX35%2BPM_MOR%2BPM_SC%2BDRIN_SPOP%2BSANI_SPOP%2BHD_POP_IND%2BRF_POP_IND%2BFT_POP_IND%2BID_POP_IND%2BGPAT_DE%2BENVRD_GBAORD%2BRERD_ERD%2BERD_GDP%2BFFRD_ERD%2BEPEA_GDP%2BODA_ENV%2BODA_BIO%2BODA_CCMIT%2BODA_CCADP%2BODA_DES%2BODA_RE%2BODA_ENVSEC%2BODA_GNI%2BENVTAX%2BENGTAX%2BENVTAX_VEH%2BECR_PC30UP%2BECR_PC60UP%2BECR_PC120UP%2BFTAX_DIE%2BFPRICE_DIE%2BFTAX_PET%2BFPRICE_PET%2BEPRICE_RES%2BEPRICE_IND%2BCSE%2BPSE_FFS%2BGSSE_FFS%2BPET_FFS%2BCOAL_FFS%2BNATG_FFS%2BELEC_FFS%2BFFS_TTAX%2BPA_MARINE%2BPA_TERRESTRIAL%2BGDP_R%2BGDP_PC%2BGDP_RCAP%2BXR%2BDEF%2BPOP_F%2BPOP_Y_LT14%2BPOP_Y15T64%2BPOP_Y_GT65%2BPOP_FERTILITY%2BPOP_LIFEEXP%2BPOP_NETMIGR%2BPOPDEN%2BPPP..&to[TIME_PERIOD]=false&ly[rw]=MEASURE%2CUNIT_MEASURE&ly[cl]=TIME_PERIOD&ly[rs]=ACTIVITY&vw=tb

And for the World Bank : https://donnees.banquemondiale.org/theme/changement-climatique



```{r}
library(here)
library(dplyr)
library(tidyr)
library(knitr)
library(ggplot2)
library(readr)
library(stringr)

```
<!-- I compute the minimum, maximum, median and mean grade at the Exam and I include the results as a tabble in the rendered document. -->
<!-- ```{r} -->
<!-- #Question 2 -->
<!-- stat_exam <- summarise(grades, min_exam = min(Exam,na.rm= TRUE), max_exam = max(Exam,na.rm= TRUE), median_exam = median(Exam, na.rm= TRUE), mean_exam = mean(Exam, na.rm= TRUE)) -->

<!-- knitr::kable(stat_exam) -->
<!-- ``` -->
<!-- I count the number of students who did not take the final exam. -->
<!-- ```{r} -->
<!-- #Question 3 -->
<!-- exam_absent <- sum(is.na(grades$Exam)) -->
<!-- print(exam_absent) -->
<!-- ``` -->

<!-- I sum the number of "NA" find in the column "Exam", there are 60. Thus, there are 60 students who did not take the final exam -->


<!-- I represent graphically the distribution of grades at the Exam by using a bar chart -->
<!-- ```{r} -->
<!-- #Question 4 -->
<!-- ggplot(grades,(aes(x=Exam, fill = after_stat(count)))) + geom_bar(na.rm = TRUE, colour="black") + geom_vline(xintercept = quantile(grades$Exam, .5, na.rm = TRUE),na.rm = TRUE, colour = "red") + labs(title = "Distribution of grades at the Exam", caption = "The red line is the median") + scale_fill_gradient() -->
<!-- ``` -->
<!-- I compute the number of students in each Group. -->
<!-- ```{r} -->
<!-- #Question 5 -->
<!-- students_by_groups <- grades %>% group_by(Group) %>% count() %>% rename("number of students" = n) -->

<!-- knitr::kable(students_by_groups) -->
<!-- ``` -->
<!-- I plot a graph with the number of students in each groups -->
<!-- ```{r} -->
<!-- #Question 6 -->
<!-- ggplot(students_by_groups, aes(x=`Group`, y=`number of students`)) + geom_col(fill = "grey50", colour = "black") + theme(axis.text.x=element_text(angle=50, size=8, vjust=0.5)) + labs(title = "Number of students in each group") -->
<!-- ``` -->
<!-- I plot two different types of graph to represent the distribution of the grades at the Exam conditioned by the group. -->
<!-- ```{r} -->
<!-- #Question 7 -->

<!-- ggplot(grades, aes(x = Group, y = Exam, fill = Group)) + geom_boxplot(na.rm = TRUE) + theme(axis.text.x=element_text(angle=50, size=8, vjust=0.5)) + labs(title = "Exam conditioned by the group", x = "Group", y = "Grades") -->

<!-- ggplot(grades, aes(x = Group, y = Exam, fill = Group)) + geom_violin(na.rm = TRUE, draw_quantiles = c(0.25, 0.5, 0.75))  + theme(axis.text.x=element_text(angle=50, size=8, vjust=0.5)) + labs(title = "Exam conditioned by the group", x = "Group", y = "Grades") -->
<!-- ``` -->
<!-- I compute the numbers of students who missed the Exam in each Group -->
<!-- ```{r} -->
<!-- #Question 8 -->
<!-- absent_group_exam <- grades %>% group_by(`Group`) %>% summarise(count = sum(is.na(Exam)))  -->

<!-- knitr::kable(absent_group_exam) -->

<!-- ``` -->
<!-- I represent graphically the results obtained in the previous question.  -->
<!-- ```{r} -->
<!-- #Question 9 -->
<!-- ggplot(absent_group_exam, aes(x=Group, y = count)) + geom_col(fill = "grey50", colour = "black") + theme(axis.text.x=element_text(angle=50, size=8, vjust=0.5)) + labs(title = "Number of students who missed the Exam in each Group", x = "Group", y = "Number of students")  -->
<!-- ``` -->
<!-- ```{r} -->
<!-- #Question 10 -->
<!-- new_df <- grades %>% group_by(Id, Group) %>% pivot_longer(cols = -c("Id","Group"), names_to = "name") -->
<!-- ``` -->
<!-- I compute the number of missing grades in total for each student -->

<!-- ```{r} -->
<!-- #Question 11 -->
<!-- absent_student <- new_df %>% group_by(`Id`) %>% summarise(count = sum(is.na(value)))  -->

<!-- ``` -->

<!-- I plot the distribution of the number of missing grades per student -->
<!-- ```{r} -->
<!-- #Question 12 -->
<!-- absent_student_distribution <- absent_student %>% group_by(count) %>% summarise(value = n()) -->

<!-- ggplot(absent_student_distribution, aes(x=count,y=value, fill = count)) + geom_col(colour = "black") + labs(title = "Distribution of the number of missing grades per student", x = "Number of missing grades", y = "Number of students") + scale_fill_gradient(low = "lightblue", high = "darkblue") -->


<!-- ``` -->
<!-- I Compute the number of students who missed the Exam in each Group -->
<!-- ```{r} -->
<!-- #Question 13 -->
<!-- missing_exam <- new_df %>% group_by(`Group`) %>% filter(str_starts(name,"Exam")) %>% summarise(count = sum(is.na(value)))  -->

<!-- knitr::kable(missing_exam) -->
<!-- ``` -->
<!-- By using the new dataframe I compute the number of missing grades for the online each student -->
<!-- ```{r} -->
<!-- #Question 14 -->
<!-- online_missing_grades <- new_df %>% group_by(`Id`) %>% filter(str_starts(name,"Online_MCQ_")) %>% summarise(online_miss = sum(is.na(value))) -->
<!-- ``` -->

<!-- I represent graphically the distribution of the grade at the Exam conditioned by the number of missing grade for the online tests. -->
<!-- ```{r} -->
<!-- #Question 15 -->
<!-- grades_online <- merge(grades, online_missing_grades, by = "Id") -->
<!-- condition_Exam_online <- grades_online %>% group_by(Exam) %>% summarise(online_miss = n()) %>% filter(!is.na(Exam)) -->

<!-- ggplot(condition_Exam_online,(aes(x=`online_miss`, y=`Exam`))) + geom_jitter(aes(colour =online_miss)) + labs(title = "Distribution of the grade at the Exam conditioned by the number of missing grade for the online tests ", x = "Number of missing grade for online tests", y = "Grade at the exam") + scale_colour_viridis_c(option="plasma") + geom_smooth(method=lm, formula = 'y ~ x')  -->

<!-- knitr::kable(condition_Exam_online) -->
<!-- ``` -->
<!-- I  create a table with two columns: Id to identify students and Missed with value TRUE -->
<!-- when the student miss at least one MCQ_xx grade and FALSE when they miss no grade. Then, I plot it in a chart. -->
<!-- ```{r} -->
<!-- #Question 16 -->
<!-- table_missed_MCQ <- new_df %>% group_by(Id) %>% filter(str_starts(name,"MCQ_")) %>% select(`Id`,`value`) %>% summarise(miss = anyNA(value)) -->

<!-- ggplot(table_missed_MCQ, aes(x=miss, fill = miss)) + geom_bar() + labs(title = "Number of students who missed at least on grade corresponding to TRUE and number of students who missed no grade corresponding to FALSE")  -->
<!-- ``` -->

<!-- I create a table with two columns : Group to identify groups and P_missed with the percentage of students in each group who missed at least on MCQ_xx grade.  -->
<!-- ```{r} -->
<!-- #Question 17  -->
<!-- group_table_missed_MCQ <- new_df %>% group_by(`Group`) %>% filter(str_starts(name,"MCQ_")) %>% select(`Group`,`value`) -->

<!-- group_table_missed_MCQ$TF <- is.na(group_table_missed_MCQ$value) -->
<!-- group_table_missed_MCQ <- group_table_missed_MCQ %>% group_by(`Group`) %>% select(`Group`,`TF`) %>% summarise(P_missed = mean((`TF`)*100)) -->

<!-- knitr::kable(group_table_missed_MCQ) -->
<!-- ``` -->
<!-- I represent graphically the average grade at the Exam per group as a function of the percentage of missed MCQ_xx.  -->
<!-- ```{r} -->
<!-- #Question 18  -->
<!-- avrg_group <- grades %>% group_by(`Group`) %>% select(`Group`,`Exam`) %>% summarise(average = mean(`Exam`, na.rm = TRUE)) -->

<!-- avrg_group <- merge(avrg_group,group_table_missed_MCQ, by = "Group") -->

<!-- ggplot(avrg_group, aes(x=`P_missed`, y = `average`)) + geom_jitter(aes(colour =P_missed)) + scale_colour_viridis_c(option="inferno") + geom_smooth(method=lm, formula = 'y ~ x') + labs(title = "The average grade at the Exam per group as a function of the percentage of missed MCQ_xx ", x = "Percentage of missing grades", y = "Average grade at the exam per group") -->

<!-- knitr::kable(avrg_group) -->
<!-- ``` -->


